function togglePollForm(){var e=document.querySelector(".qa-poll-form"),t=document.querySelector(".qa-poll-toggle-btn");"none"===e.style.display||""===e.style.display?(e.style.display="block",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13H5v-2h14v2z"/></svg> Hide Poll'):(e.style.display="none",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg> Add Poll')}function addPollOption(){var e,t=document.querySelector(".qa-poll-options-list"),o=t.children.length;10<=o?alert("Maximum 10 options allowed."):((e=document.createElement("div")).className="qa-poll-option-input",e.innerHTML='<input type="text" name="poll_options[]" placeholder="Option '+(o+1)+'" class="qa-form-tall-text">',t.appendChild(e))}function votePoll(t,o,l){var e;l.classList.contains("loading")||(l.classList.add("loading"),(e=new FormData).append("pollid",t),e.append("optionid",o),fetch(pollAjaxURL,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.ok?e.json():e.text().then(e=>{try{return{error:!0,data:JSON.parse(e)}}catch(e){throw new Error("Server error occurred")}})).then(e=>{l.classList.remove("loading"),e.error&&e.data?showError(e.data.error||"An error occurred while voting."):e.success?(updatePollDisplay(e.poll_data),updateVoteStatus(l,"voted"===e.action),updateAllPollOptions(t,"voted"===e.action?o:null)):showError(e.error||"An error occurred while voting.")}).catch(e=>{l.classList.remove("loading"),showError(e.message||"Network error. Please try again.")}))}function updatePollDisplay(e){const a=document.querySelector(".qa-poll-container");if(a&&e){const n=e.total_votes,r=e.hide_results||!1,s=e.user_voted_option||null;var t;e.options.forEach(e=>{var t,o,l=a.querySelector(`[data-optionid="${e.optionid}"]`);l&&(t=0<n?Math.round(e.votes/n*100):0,s&&s==e.optionid?l.classList.add("qa-poll-option-voted"):l.classList.remove("qa-poll-option-voted"),!r)&&((o=l.querySelector(".qa-poll-option-fill"))&&(o.style.width=t+"%"),o=l.querySelector(".qa-poll-option-votes"))&&(o.innerHTML='<span class="vote-percentage">'+t+'%</span><span class="vote-count">('+e.votes+')</span><span class="polling_icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M340.864 149.312a30.592 30.592 0 0 0 0 42.752L652.736 512 340.864 831.872a30.592 30.592 0 0 0 0 42.752 29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"></path></svg></span>')}),r||((t=a.querySelector(".qa-poll-total"))&&(t.textContent=n+" votes"),updatePollChart(e))}}function updatePollChart(e){var t,o=document.querySelector(".qa-poll-container");o&&e&&e.options&&("undefined"==typeof Chart?console.warn("Chart.js not loaded, skipping chart update"):(o=o.querySelector('canvas[id^="poll-chart-"]'))&&(o=o.id,o=Chart.getChart(o))&&(t=e.options.map(e=>{let t=e.option_text;return t=30<t.length?t.substring(0,27)+"...":t}),e=e.options.map(e=>e.votes),o.data.labels=t,o.data.datasets[0].data=e,o.update()))}function updateVoteStatus(e,t){t?e.classList.add("qa-poll-option-voted"):e.classList.remove("qa-poll-option-voted")}function updateAllPollOptions(e,o){var t=document.querySelector(".qa-poll-container");t&&t.querySelectorAll(".qa-poll-option").forEach(e=>{var t=e.getAttribute("data-optionid");o&&t==o?e.classList.add("qa-poll-option-voted"):e.classList.remove("qa-poll-option-voted"),e.style.pointerEvents="auto",e.style.opacity="1"})}function showError(e){var t=document.querySelector(".qa-poll-error");t&&t.remove();const o=document.createElement("div");o.className="qa-poll-error",o.textContent=e,(t=document.querySelector(".qa-poll-container"))&&(t.insertBefore(o,t.firstChild),setTimeout(()=>{o.parentNode&&o.remove()},5e3))}function showSuccess(e){var t=document.querySelector(".qa-poll-success");t&&t.remove();const o=document.createElement("div");o.className="qa-poll-success",o.textContent=e,(t=document.querySelector(".qa-poll-container"))&&(t.insertBefore(o,t.firstChild),setTimeout(()=>{o.parentNode&&o.remove()},3e3))}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".qa-poll-option").forEach(e=>{e.addEventListener("click",function(){votePoll(this.getAttribute("data-pollid"),this.getAttribute("data-optionid"),this)})});var e=document.querySelector('form[name="ask"]');e&&e.addEventListener("submit",function(e){var t=document.getElementById("poll_question"),o=document.querySelectorAll('input[name="poll_options[]"]'),l=document.querySelector(".qa-poll-form");if(l&&"none"!==l.style.display)if(t.value.trim()){let t=0;o.forEach(e=>{e.value.trim()&&t++}),t<2&&(e.preventDefault(),alert("Please provide at least 2 poll options."))}else e.preventDefault(),alert("Please enter a poll question."),t.focus()})}),document.addEventListener("keydown",function(e){var t;"Enter"!==e.key&&" "!==e.key||(t=document.activeElement)&&t.classList.contains("qa-poll-option")&&(e.preventDefault(),t.click())});